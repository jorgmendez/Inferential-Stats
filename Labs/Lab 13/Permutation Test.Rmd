---
title: "Permutation Test ; Smoking and Birth Weight"
author: "Jorge Mendez"
date: "2025-11-06"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Purpose of the Lab

In this lab, we perform a permutation test to determine whether babies born to non-smoking mothers weigh more on average than those born to smoking mothers.

We are testing the hypotheses:
$$
H_0: \mu_{\text{non-smoke}} \le \mu_{\text{smoke}} \quad \text{vs.} \quad H_A: \mu_{\text{non-smoke}} > \mu_{\text{smoke}}
$$
where ùúáis the population mean birth weight (in grams).

We‚Äôll use resampling (permutation) methods instead of traditional parametric tests to approximate the null distribution of the mean difference.

```{r}
library(resampledata3)
data(NCBirths2004)
```


## Observed Mean Difference
Before running any simulations, we first compute the observed difference in mean baby weights between non-smokers and smokers:
$$
\text{Observed difference} = \bar{X}_{\text{non-smoke}} - \bar{X}_{\text{smoke}}
$$


This tells us how much heavier, on average, babies of non-smoking mothers are compared to those of smoking mothers in the sample.
```{r}
non_smoke <- subset(NCBirths2004, Smoker == "No")$Weight
smoke <- subset(NCBirths2004, Smoker == "Yes")$Weight

obs_diff <- mean(non_smoke) - mean(smoke)
obs_diff


```

That means, on average, babies born to non-smoking mothers weigh about 215 grams more than those born to smoking mothers.


## Simulate the Null Distribution
Under the null hypothesis 
$H_0$, we assume that smoking has no real effect on baby weight.
If that‚Äôs true, then the labels ‚ÄúYes‚Äù and ‚ÄúNo‚Äù (for Smoker) are meaningless ‚Äî we could shuffle them randomly, and any difference in means would just be due to chance.

So, we‚Äôll simulate that process many times:

1.- Randomly shuffle the ‚ÄúSmoker‚Äù labels.

2.- Recalculate the mean difference each time.

3.- Store those differences to create a null distribution.

This gives us a picture of what differences we‚Äôd expect if the null hypothesis were true.


```{r}
set.seed(123) 
n_perm <- 5000
diffs <- numeric(n_perm)

for (i in 1:n_perm) {
  shuffled <- sample(NCBirths2004$Smoker)
  diffs[i] <- mean(NCBirths2004$Weight[shuffled == "No"]) -
              mean(NCBirths2004$Weight[shuffled == "Yes"])
}

```



## Compute the One-Sided p-Value and Visualize
Now that we have the null distribution (the 5,000 simulated mean differences), we can check how extreme our observed statistic (‚âà215 g) is compared to that distribution.

Our alternative hypothesis is one-sided:
$$
H_A: \mu_{\text{non-smoke}} > \mu_{\text{smoke}}
$$

So, we‚Äôll calculate the proportion of simulated differences that are greater than or equal to our observed difference.
That proportion is our p-value; the probability of observing a difference at least as large as 215 g if the null hypothesis were true.


```{r}
p_value <- mean(diffs >= obs_diff)
p_value

```
### Handling a p-value of 0

After running the permutation test, the output of the p-value is 0.

This result means that none of the 5,000 simulated mean differences were as large as the observed difference of 215 g.
It doesn‚Äôt mean the probability is exactly zero ‚Äî it just means the p-value is smaller than the resolution of our simulation (1 / 5000 = 0.0002).

In other words, $p\text{-value} < 0.0002$.


This provides very strong evidence against the null hypothesis $H_0$.





## Interpretation
Because the p-value is extremely small (essentially 0), we reject the null hypothesis.
This means that the difference in baby weights is statistically significant, and babies born to non-smoking mothers weigh significantly more than those born to smoking mothers on average.


```{r}
hist(diffs, breaks = 30, col = "lightblue",
     main = "Permutation Null Distribution",
     xlab = "Mean Difference (Non-Smoker - Smoker)",
     xlim = c(min(diffs) - 50, max(diffs) + 250))
abline(v = obs_diff, col = "red", lwd = 2)
text(obs_diff, 400, paste("Observed =", round(obs_diff, 2)), pos = 4)

```


# Conclusion


In this lab, we tested whether babies born to non-smoking mothers weigh more on average than those born to smoking mothers using a permutation test with 5,000 random shuffles of the ‚ÄúSmoker‚Äù labels.
The observed mean difference in baby weight was 215 g, while the simulated null distribution centered around 0.
Because none of the 5,000 permutations produced a difference as large as 215 g, the resulting p-value was 0 (< 0.0002).
Therefore, we reject H‚ÇÄ and conclude that babies of non-smoking mothers weigh significantly more on average than those of smoking mothers.


